#include <stdio.h>
#include <stdlib.h>
#include "RS.h"
#include "RAC.h"
#include "RAL.h"

int lectura_operaciones(PrestadorRAL RAL[], RAC *tablaRAC, RS *tablaRS) {
    PrestadorRAL aux;
    PrestadorRAC auxRAC;
    PrestadorRS auxRS;
    inicializar(RAL);
    init_RAC(tablaRAC);
    init_RS(tablaRS);

    int opcion = 0, exito, pos;
    int costo = 0;
    int DNI;

    FILE *fp = fopen("Operaciones-Prestadores.txt", "r");
    if (fp == NULL) {
        printf("No se puede abrir el archivo\n");
        return 0;
    }

    while (!feof(fp)) {
        fscanf(fp, "%d", &opcion);
        fscanf(fp, "%d", &aux.DNI);

        if (opcion == 1 || opcion == 2) {
            fscanf(fp, " %[^\n]", aux.nombreyapellido);
            fscanf(fp, " %[^\n]", aux.servicios);
            fscanf(fp, " %[^\n]", aux.domicilio);
            fscanf(fp, " %[^\n]", aux.correo);
            fscanf(fp, " %[^\n]", aux.telefono);

            // Copiar los datos de 'aux' a 'auxRAC' para RAC
            auxRAC.DNI = aux.DNI;
            strcpy(auxRAC.nombreyapellido, aux.nombreyapellido);
            strcpy(auxRAC.servicios, aux.servicios);
            strcpy(auxRAC.domicilio, aux.domicilio);
            strcpy(auxRAC.correo, aux.correo);
            strcpy(auxRAC.telefono, aux.telefono);

            // Copiar también para RS
            auxRS.DNI = aux.DNI;
            strcpy(auxRS.nombreyapellido, aux.nombreyapellido);
            strcpy(auxRS.servicios, aux.servicios);
            strcpy(auxRS.domicilio, aux.domicilio);
            strcpy(auxRS.correo, aux.correo);
            strcpy(auxRS.telefono, aux.telefono);

            if (opcion == 1) {  // Alta
                if (CantElem < MRAL) {
                    Alta_RAL(RAL, aux, aux.DNI, &exito, opcion);
                    Alta_RAC(tablaRAC, auxRAC, &costo);
                    Alta_RS(tablaRS, auxRS, &costo);  // Insertamos 'auxRS' en la estructura RS
                }
            } else {  // Baja
                DNI = aux.DNI;
                Baja_RAL(RAL, DNI, &exito, aux, opcion);
                Baja_RAC(tablaRAC, DNI, &costo);
                Baja_RS(tablaRS, DNI, &costo);
            }
        } else if (opcion == 3) {  // Evocar
            Evocar_RAL(RAL, &aux, aux.DNI, &exito, &costo);
            Evocar_RAC(tablaRAC, aux.DNI, &costo);
            Evocar_RS(tablaRS, aux.DNI, &costo);
        }
    }

    fclose(fp);
    return 1;
}


int main()
{
    RS tablaRS;
    int opcion;
    PrestadorRAL RAL[MRAL];  // Ajuste de tipo de prestadores
    RAC tablaRAC;

    do {
        printf("--------------------BIENVENIDO-------------------\n");
        printf("------------------ MENU PRINCIPAL----------------\n");
        printf("1: Comparar estructuras \n");
        printf("2: Mostrar: RAL \n");
        printf("3: Mostrar: RAC \n");
        printf("4: Mostrar: RS \n");
        printf("5: Salir \n");
        printf("-------------------------------------------------\n");
        scanf("%d", &opcion);

        switch (opcion) {
            case 1:  // Lectura y comparación de operaciones
                lectura_operaciones(RAL, &tablaRAC, &tablaRS);
                // Costos RAL
                printf("________________________Costos_________________________________\n");
                printf("Rebalse Abierto Lineal \n");
                // Costos de evocaciones exitosas
                if (cantEvocExitosa_RAL > 0) {
                    float promedioEvocExitosa_RAL = totalEvocExitosa_RAL / (float)cantEvocExitosa_RAL;
                    printf("Costo maximo de evocacion exitosa en RAL: %d\n", maxEvocExitosa_RAL);
                    printf("Costo medio de evocación exitosa en RAL: %.2f\n", promedioEvocExitosa_RAL);
                } else {
                    printf("No hubo evocaciones exitosas en RAL\n");
                }

                // Costos de evocaciones no exitosas
                if (cantEvocNoExitosa_RAL > 0) {
                    float promedioEvocNoExitosa_RAL = totalEvocNoExitosa_RAL / (float)cantEvocNoExitosa_RAL;
                    printf("Costo maximo de evocacion no exitosa en RAL: %d\n", maxEvocNoExitosa_RAL);
                    printf("Costo medio de evocacion no exitosa en RAL: %.2f\n", promedioEvocNoExitosa_RAL);
                } else {
                    printf("No hubo evocaciones no exitosas en RAL\n");
                }


                // Costos RAC
                printf("___________________________________________________ \n");
                printf("Rebalse Abierto Cuadratico \n");

                if (cantEvocExitosa_RAC > 0) {
                    float promedioEvocExitosa_RAC = totalEvocExitosa_RAC / (float)cantEvocExitosa_RAC;
                    printf("Costo maximo de evocacion exitosa en RAC: %d\n", maxEvocExitosa_RAC);
                    printf("Costo medio de evocacion exitosa en RAC: %.2f\n", promedioEvocExitosa_RAC);
                } else {
                    printf("No hubo evocaciones exitosas en RAC\n");
                }

                // Costos de evocaciones no exitosas
                if (cantEvocNoExitosa_RAC > 0) {
                    float promedioEvocNoExitosa_RAC = totalEvocNoExitosa_RAC / (float)cantEvocNoExitosa_RAC;
                    printf("Costo maximo de evocacion no exitosa en RAC: %d\n", maxEvocNoExitosa_RAC);
                    printf("Costo medio de evocacion no exitosa en RAC: %.2f\n", promedioEvocNoExitosa_RAC);
                } else {
                    printf("No hubo evocaciones no exitosas en RAC\n");
                }


                //Costos RS
                printf("___________________________________________________ \n");
                printf("Rebalse Separado \n");
                // Costos de evocaciones exitosas
                if (cantEvocExitosa_RS > 0) {
                    float promedioEvocExitosa_RS = totalEvocExitosa_RS / (float)cantEvocExitosa_RS;
                    printf("Costo maximo de evocacion exitosa en RS: %d\n", maxEvocExitosa_RS);
                    printf("Costo medio de evocacion exitosa en RS: %.2f\n", promedioEvocExitosa_RS);
                } else {
                    printf("No hubo evocaciones exitosas en RS\n");
                }

                // Costos de evocaciones no exitosas
                if (cantEvocNoExitosa_RS > 0) {
                    float promedioEvocNoExitosa_RS = totalEvocNoExitosa_RS / (float)cantEvocNoExitosa_RS;
                    printf("Costo maximo de evocacion no exitosa en RS: %d\n", maxEvocNoExitosa_RS);
                    printf("Costo medio de evocacion no exitosa en RS: %.2f\n", promedioEvocNoExitosa_RS);
                } else {
                    printf("No hubo evocaciones no exitosas en RS\n");
                }


                break;

            case 2:  // Mostrar RAL
                MostrarEstructura_RAL(RAL);
                break;

            case 3:  // Mostrar RAC
                MostrarEstructura_RAC(&tablaRAC);
                break;

            case 4:  // Mostrar RS
                MostrarEstructura_RS(&tablaRS);
                break;
            case 5:
                printf("Saliendo...\n");
                break;
            default:
                printf("Error eliga una opcion valida. \n");
                break;
        }
    } while (opcion != 5);

    return 0;
}
